<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weather Image Downloader</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    input, select {
      margin: 10px 0;
      padding: 6px;
    }
    img {
      max-width: 100%;
      margin: 10px 0;
      border: 1px solid #ccc;
    }
    .image-container {
      margin-bottom: 30px;
    }
    .download-btn {
      display: inline-block;
      padding: 6px 12px;
      margin-top: 5px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h2>Weather Images by Date</h2>

  <label for="dateInput">Select a date:</label><br>
  <input type="date" id="dateInput"><br><br>

  <label for="stationSelect">Choose a station:</label><br>
  <select id="stationSelect">
    <option value="">-- Select a station --</option>
    <option value="ALBA">ALBA</option>
    <option value="BING">BING</option>
    <option value="BUFF">BUFF</option>
    <option value="NYC1">NYC1</option>
    <option value="JFK1">JFK1</option>
    <option value="SYRA">SYRA</option>
    <!-- Add more station codes as needed -->
  </select><br><br>

  <div class="image-container">
    <h3>Station Plot</h3>
    <img id="image1" src="" alt="Station image will appear here">
    <br>
    <button id="download1" class="download-btn">Download Station Plot</button>
  </div>

  <div class="image-container">
    <h3>Surface Fronts</h3>
    <img id="image2" src="" alt="Fronts image will appear here">
    <br>
    <button id="download2" class="download-btn">Download Surface Fronts</button>
  </div>

  <script>
    const dateInput = document.getElementById('dateInput');
    const stationSelect = document.getElementById('stationSelect');
    const image1 = document.getElementById('image1');
    const image2 = document.getElementById('image2');
    const download1 = document.getElementById('download1');
    const download2 = document.getElementById('download2');

    // const proxyBase = 'http://localhost:3000/proxy?url=';
    const proxyBase = 'https://daily-graph.onrender.com/proxy?url=';

    function triggerDownload(proxiedUrl, filename) {
      const a = document.createElement('a');
      a.href = proxiedUrl;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    function updateImages() {
      const date = dateInput.value;
      const station = stationSelect.value;

      if (!date) return;

      const [year, month, day] = date.split("-");
      const yyyymmdd = `${year}${month}${day}`;

      const rawUrl1 = station
        ? `https://operations.nysmesonet.org/~nbassill/archive/${year}/${month}/${day}/station/${station}.png`
        : "";

      const rawUrl2 = `https://www.wpc.ncep.noaa.gov/archives/sfc/${year}/usfntsfc${yyyymmdd}15.gif`;

      const proxyUrl1 = rawUrl1 ? proxyBase + encodeURIComponent(rawUrl1) : "";
      const proxyUrl2 = proxyBase + encodeURIComponent(rawUrl2);

      if (station) {
        image1.src = rawUrl1;
        download1.onclick = () => triggerDownload(proxyUrl1, `${station}_${yyyymmdd}.png`);
      } else {
        image1.src = "";
        download1.onclick = null;
      }

      image2.src = rawUrl2;
      download2.onclick = () => triggerDownload(proxyUrl2, `usfntsfc${yyyymmdd}15.gif`);
    }

    dateInput.addEventListener('change', updateImages);
    stationSelect.addEventListener('change', updateImages);
  </script>

</body>
</html>
