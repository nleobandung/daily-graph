<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weather Image Downloader</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    input, select {
      margin: 10px 0;
      padding: 6px;
    }
    img {
      max-width: 100%;
      margin: 10px 0;
      border: 1px solid #ccc;
    }
    .image-container {
      margin-bottom: 30px;
    }
    .download-btn {
      display: inline-block;
      padding: 6px 12px;
      margin-top: 5px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h2>Weather Images by Date</h2>

  <label for="dateInput">Select a date:</label><br>
  <input type="date" id="dateInput"><br><br>

  <label for="stationSelect">Choose a station:</label><br>
  <select id="stationSelect">
    <option value="">-- Select a station --</option>
    <option value="ADDI">ADDI</option>
    <option value="ANDE">ANDE</option>
    <option value="BATA">BATA</option>
    <option value="BEAC">BEAC</option>
    <option value="BELD">BELD</option>
    <option value="BELL">BELL</option>
    <option value="BELM">BELM</option>
    <option value="BERK">BERK</option>
    <option value="BING">BING</option>
    <option value="BKLN">BKLN</option>
    <option value="BRAN">BRAN</option>
    <option value="BREW">BREW</option>
    <option value="BROC">BROC</option>
    <option value="BRON">BRON</option>
    <option value="BROO">BROO</option>
    <option value="BSPA">BSPA</option>
    <option value="BUFF">BUFF</option>
    <option value="BURD">BURD</option>
    <option value="BURT">BURT</option>
    <option value="CAMD">CAMD</option>
    <option value="CAPE">CAPE</option>
    <option value="CHAZ">CHAZ</option>
    <option value="CHES">CHES</option>
    <option value="CINC">CINC</option>
    <option value="CLAR">CLAR</option>
    <option value="CLIF">CLIF</option>
    <option value="CLYM">CLYM</option>
    <option value="COBL">COBL</option>
    <option value="COHO">COHO</option>
    <option value="COLD">COLD</option>
    <option value="COPA">COPA</option>
    <option value="COPE">COPE</option>
    <option value="CROG">CROG</option>
    <option value="CSQR">CSQR</option>
    <option value="DELE">DELE</option>
    <option value="DEPO">DEPO</option>
    <option value="DOVE">DOVE</option>
    <option value="DUAN">DUAN</option>
    <option value="EAUR">EAUR</option>
    <option value="EDIN">EDIN</option>
    <option value="EDWA">EDWA</option>
    <option value="ELDR">ELDR</option>
    <option value="ELLE">ELLE</option>
    <option value="ELMI">ELMI</option>
    <option value="ESSX">ESSX</option>
    <option value="ETEC10">ETEC10</option>
    <option value="FAYE">FAYE</option>
    <option value="FRED">FRED</option>
    <option value="GABR">GABR</option>
    <option value="GFAL">GFAL</option>
    <option value="GFLD">GFLD</option>
    <option value="GROT">GROT</option>
    <option value="GROV">GROV</option>
    <option value="HAMM">HAMM</option>
    <option value="HARP">HARP</option>
    <option value="HARR">HARR</option>
    <option value="HART">HART</option>
    <option value="HERK">HERK</option>
    <option value="HFAL">HFAL</option>
    <option value="ILAK">ILAK</option>
    <option value="JOHN">JOHN</option>
    <option value="JORD">JORD</option>
    <option value="KIND">KIND</option>
    <option value="LAUR">LAUR</option>
    <option value="LKPL">LKPL</option>
    <option value="LOUI">LOUI</option>
    <option value="MALO">MALO</option>
    <option value="MANH">MANH</option>
    <option value="MEDI">MEDI</option>
    <option value="MEDU">MEDU</option>
    <option value="MORR">MORR</option>
    <option value="NBRA">NBRA</option>
    <option value="NEWC">NEWC</option>
    <option value="NHUD">NHUD</option>
    <option value="OLDF">OLDF</option>
    <option value="OLEA">OLEA</option>
    <option value="ONTA">ONTA</option>
    <option value="OPPE">OPPE</option>
    <option value="OSCE">OSCE</option>
    <option value="OSWE">OSWE</option>
    <option value="OTIS">OTIS</option>
    <option value="OWEG">OWEG</option>
    <option value="PENN">PENN</option>
    <option value="PHIL">PHIL</option>
    <option value="PISE">PISE</option>
    <option value="POTS">POTS</option>
    <option value="QUEE">QUEE</option>
    <option value="RAND">RAND</option>
    <option value="RAQU">RAQU</option>
    <option value="REDF">REDF</option>
    <option value="REDH">REDH</option>
    <option value="ROXB">ROXB</option>
    <option value="RUSH">RUSH</option>
    <option value="SARA">SARA</option>
    <option value="SBRI">SBRI</option>
    <option value="SCHA">SCHA</option>
    <option value="SCHO">SCHO</option>
    <option value="SCHU">SCHU</option>
    <option value="SCIP">SCIP</option>
    <option value="SHER">SHER</option>
    <option value="SKYWAY">SKYWAY</option>
    <option value="SOME">SOME</option>
    <option value="SOUT">SOUT</option>
    <option value="SPRA">SPRA</option>
    <option value="SPRI">SPRI</option>
    <option value="STAT">STAT</option>
    <option value="STEP">STEP</option>
    <option value="STON">STON</option>
    <option value="SUFF">SUFF</option>
    <option value="TANN">TANN</option>
    <option value="TICO">TICO</option>
    <option value="TULL">TULL</option>
    <option value="TUPP">TUPP</option>
    <option value="TYRO">TYRO</option>
    <option value="VOOR">VOOR</option>
    <option value="WALL">WALL</option>
    <option value="WALT">WALT</option>
    <option value="WANT">WANT</option>
    <option value="WARS">WARS</option>
    <option value="WARW">WARW</option>
    <option value="WATE">WATE</option>
    <option value="WBOU">WBOU</option>
    <option value="WELL">WELL</option>
    <option value="WEST">WEST</option>
    <option value="WFMB">WFMB</option>
    <option value="WGAT">WGAT</option>
    <option value="WHIT">WHIT</option>
    <option value="WOLC">WOLC</option>
    <option value="YORK">YORK</option>

    <!-- Add more station codes as needed -->
  </select><br><br>

  <div class="image-container">
    <h3>Station Plot</h3>
    <img id="image1" src="" alt="Station image will appear here">
    <br>
    <button id="download1" class="download-btn">Download Station Plot</button>
  </div>

  <div class="image-container">
    <h3>Surface Fronts</h3>
    <img id="image2" src="" alt="Fronts image will appear here">
    <br>
    <button id="download2" class="download-btn">Download Surface Fronts</button>
  </div>

  <script>
    const dateInput = document.getElementById('dateInput');
    const stationSelect = document.getElementById('stationSelect');
    const image1 = document.getElementById('image1');
    const image2 = document.getElementById('image2');
    const download1 = document.getElementById('download1');
    const download2 = document.getElementById('download2');

    // const proxyBase = 'http://localhost:3000/proxy?url=';
    const proxyBase = 'https://daily-graph.onrender.com/proxy?url=';

    function triggerDownload(proxiedUrl, filename) {
      const a = document.createElement('a');
      a.href = proxiedUrl;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    function updateImages() {
      const date = dateInput.value;
      const station = stationSelect.value;

      if (!date) return;

      const [year, month, day] = date.split("-");
      const yyyymmdd = `${year}${month}${day}`;

      const rawUrl1 = station
        ? `https://operations.nysmesonet.org/~nbassill/archive/${year}/${month}/${day}/station/${station}.png`
        : "";

      const rawUrl2 = `https://www.wpc.ncep.noaa.gov/archives/sfc/${year}/usfntsfc${yyyymmdd}15.gif`;

      const proxyUrl1 = rawUrl1 ? proxyBase + encodeURIComponent(rawUrl1) : "";
      const proxyUrl2 = proxyBase + encodeURIComponent(rawUrl2);

      if (station) {
        image1.src = rawUrl1;
        download1.onclick = () => triggerDownload(proxyUrl1, `${station}_${yyyymmdd}.png`);
      } else {
        image1.src = "";
        download1.onclick = null;
      }

      image2.src = rawUrl2;
      download2.onclick = () => triggerDownload(proxyUrl2, `usfntsfc${yyyymmdd}15.gif`);
    }

    dateInput.addEventListener('change', updateImages);
    stationSelect.addEventListener('change', updateImages);
  </script>

</body>
</html>
